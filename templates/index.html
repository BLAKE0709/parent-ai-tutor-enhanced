<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parent‑AI Tutor</title>
    <!-- Bootswatch Lux theme for a polished look -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-FK1sQBlA5VT1KfrQSJWVGDJEv4IKfW3/rcw8NfBWBf8TAnEFXG57qzLWdGtbd6ju"
      crossorigin="anonymous"
    />
    <!-- Google Font for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <!-- Hero header -->
      <header class="pb-4 mb-4 border-bottom">
        <div class="text-center">
          <h1 class="display-4 fw-bold mb-2">Parent‑AI Tutor</h1>
          <p class="lead text-muted">Age‑smart AI answers and mini lessons for your child&nbsp;&mdash; guided by you.</p>
        </div>
      </header>
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          <div id="chat-box" class="mb-3 border rounded p-3 bg-white shadow-sm"
               style="height: 50vh; overflow-y: auto;">
            <!-- Messages will appear here -->
          </div>
          <form id="chat-form">
            <div class="row g-2 mb-2 align-items-center">
              <div class="col-4 col-md-3">
                <input
                  type="number"
                  id="age-input"
                  class="form-control"
                  placeholder="Age"
                  min="1"
                  max="18"
                  required
                />
              </div>
              <div class="col-8 col-md-9">
                <input
                  type="text"
                  id="message-input"
                  class="form-control"
                  placeholder="Ask a question..."
                  required
                />
              </div>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">Send</button>
            </div>
          </form>
          <div id="error-alert" class="alert alert-danger mt-3 d-none" role="alert"></div>

          <!-- Suggested questions -->
          <div id="suggestions" class="mt-4">
            <h5 class="fw-semibold">Not sure what to ask? Try one of these:</h5>
            <div class="d-flex flex-wrap gap-2">
              <!-- Suggestions will be injected by JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoHY14mYI4m4YYxw23zdp6/w52UdvqcI1JzeAG88/1RAnYQ"
      crossorigin="anonymous"></script>
    <script>
      const chatForm = document.getElementById('chat-form');
      const chatBox = document.getElementById('chat-box');
      const errorAlert = document.getElementById('error-alert');

      // List of suggested starter questions.  Feel free to add more or adjust.
      const suggestions = [
        'What is artificial intelligence?',
        'How can I explain machine learning to a 10‑year‑old?',
        'Are there kid‑friendly AI projects we can try?',
        'How does AI impact daily life?',
        'What are the benefits and risks of AI for children?'
      ];

      // Render suggestion buttons
      const suggestionsContainer = document.querySelector('#suggestions .d-flex');
      suggestions.forEach((text) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-outline-secondary btn-sm';
        btn.textContent = text;
        btn.addEventListener('click', () => {
          const age = document.getElementById('age-input').value;
          document.getElementById('message-input').value = text;
          // Optionally submit automatically
          chatForm.dispatchEvent(new Event('submit'));
        });
        suggestionsContainer.appendChild(btn);
      });

      function appendMessage(content, isUser) {
        const wrapper = document.createElement('div');
        wrapper.classList.add('d-flex', 'mb-2');
        wrapper.classList.add(isUser ? 'justify-content-end' : 'justify-content-start');
        const bubble = document.createElement('div');
        bubble.classList.add('p-2', 'chat-bubble', isUser ? 'bg-primary' : 'bg-secondary', 'text-white');
        bubble.style.maxWidth = '75%';
        // Use innerText to preserve line breaks but escape HTML
        bubble.innerText = content;
        wrapper.appendChild(bubble);
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorAlert.classList.add('d-none');
        const age = document.getElementById('age-input').value;
        const message = document.getElementById('message-input').value.trim();
        if (!message) return;
        appendMessage(message, true);
        document.getElementById('message-input').value = '';
        try {
          const response = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, age }),
          });
          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || 'An error occurred');
          }
          appendMessage(data.response, false);
        } catch (err) {
          errorAlert.textContent = err.message;
          errorAlert.classList.remove('d-none');
        }
      });
    </script>
  </body>
</html>
