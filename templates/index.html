<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parent‑AI Tutor</title>
    <!-- Core Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoHY14mYI4m4YYxw23zdp6/w52UdvqcI1JzeAG88/1RAnYQ"
      crossorigin="anonymous"
    />
    <!-- Google Font for modern typography -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" />
  </head>
  <body
    class="d-flex flex-column justify-content-center align-items-center min-vh-100"
  >
    <!-- Main container -->
    <div class="central-container text-center">
      <!-- Hero header -->
      <header class="mb-4 text-center">
        <h2 class="fw-bold mb-3">What’s on your mind today?</h2>
        <p class="text-muted mb-4">
          Age‑smart AI answers<br />
          &amp; mini lessons
        </p>
      </header>
      <!-- Chat box (conversation history) -->
      <div id="chat-box" class="mb-4"></div>
      <!-- Form: central search bubble with age input on top -->
      <form id="chat-form" class="mb-3">
        <!-- Age container sits above the prompt bar -->
        <div class="age-container text-center">
          <input
            type="number"
            id="age-input"
            class="age-input"
            placeholder="Age"
            min="1"
            max="18"
            required
          />
        </div>
        <!-- Prompt bar -->
        <div class="search-bar d-flex align-items-center">
          <input
            type="text"
            id="message-input"
            class="form-control flex-grow-1"
            placeholder="Ask anything..."
            required
          />
          <button type="submit" class="btn send-btn">
            &rarr;
          </button>
        </div>
      </form>
      <div id="error-alert" class="alert alert-danger d-none mb-3" role="alert"></div>
      <!-- Suggested questions -->
      <div id="suggestions" class="mt-4">
        <h5 class="fw-semibold text-center mb-2">
          Not sure what to ask? Try one of these:
        </h5>
        <div class="d-flex flex-wrap gap-2 justify-content-center"></div>
      </div>
    </div>
    <!-- Footer -->
    <footer class="text-center mt-5 text-muted small">
      Built with ❤️ for parents and kids
    </footer>
    <!-- Bootstrap JS Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoHY14mYI4m4YYxw23zdp6/w52UdvqcI1JzeAG88/1RAnYQ"
      crossorigin="anonymous"
    ></script>
    <script>
      const chatForm = document.getElementById('chat-form');
      const chatBox = document.getElementById('chat-box');
      const errorAlert = document.getElementById('error-alert');

      // List of suggested starter questions. Feel free to add more or adjust.
      const suggestions = [
        'What is artificial intelligence?',
        'How can I explain machine learning to a 10‑year‑old?',
        'Are there kid‑friendly AI projects we can try?',
        'How does AI impact daily life?',
        'What are the benefits and risks of AI for children?'
      ];

      // Render suggestion buttons
      const suggestionsContainer = document.querySelector('#suggestions .d-flex');
      suggestions.forEach((text) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-outline-secondary btn-sm';
        btn.textContent = text;
        btn.addEventListener('click', () => {
          document.getElementById('message-input').value = text;
          chatForm.dispatchEvent(new Event('submit'));
        });
        suggestionsContainer.appendChild(btn);
      });

      function appendMessage(content, isUser) {
        const wrapper = document.createElement('div');
        wrapper.classList.add('d-flex', 'mb-2');
        wrapper.classList.add(isUser ? 'justify-content-end' : 'justify-content-start');
        const bubble = document.createElement('div');
        bubble.classList.add('chat-bubble');
        bubble.classList.add(isUser ? 'user-bubble' : 'assistant-bubble');
        bubble.style.maxWidth = '75%';
        bubble.innerText = content;
        wrapper.appendChild(bubble);
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorAlert.classList.add('d-none');
        const age = document.getElementById('age-input').value;
        const message = document.getElementById('message-input').value.trim();
        if (!message) return;
        appendMessage(message, true);
        document.getElementById('message-input').value = '';
        try {
          const response = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, age }),
          });
          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || 'An error occurred');
          }
          appendMessage(data.response, false);
        } catch (err) {
          errorAlert.textContent = err.message;
          errorAlert.classList.remove('d-none');
        }
      });
    </script>
  </body>
</html>